<script>
document.addEventListener('DOMContentLoaded', () => {
  try {
    const numbers = [
      "OTE4MzI5Njc5OTI5","OTE3ODE4MDI2NjA1","OTE3MDYxMjE3MTM0",
      "OTE5MDY0NTg3MDAz","OTE3NDE1MTk4NjA5","OTE5MDgxODM1Njc3",
      "OTE5OTU3MzcyNzI1","OTE5NjMyMTYyNDA4","OTE2MjA0OTMyMDA4",
      "OTE4NDA5NzQxNTIx","OTE5MDIzNTMxNDIy","OTE4ODczMTc2MDIw",
      "OTE3NzU3MDgzMjA1","OTE3OTgzNjYyNTMy","OTE5OTg5NjM5MjE3",
      "OTE2MjAwNDEwOTY4","OTE3OTg5MzkxNDE1","OTE5MTQ5Njk0MTI2",
      "OTE2MzUzNDk4MDI2","OTE2MjgxODM5NTM4","OTE3NDM5MzE3NDM5",
      "OTE5MjQzMzc4NjI3","OTE4ODIyMTk0NDI2","OTE5MTIxODkzOTY4",
      "OTE5MjM5NDk4NjMw","OTE4OTg5NjE4OTA3","OTE2MzY5OTU2OTIx",
      "OTE3NzI3ODc1ODIy","OTE4NzU0NTcxNjAy","OTE5MDIyMDk2MTIz"
    ];

    const TELEGRAM_URL = "https://t.me/+opFikXeh63YzYzll";
    const THRESHOLD = 4;
    const MAX_NUMBERS = 8;

    let clickCount = parseInt(localStorage.getItem('linkClicks')) || 0;
    let telegramRedirectCount = parseInt(localStorage.getItem('tgRedirects')) || 0;
    let totalNumbersShown = parseInt(localStorage.getItem('totalNumbersShown')) || 0;

    function showLimitExpired() {
      document.body.innerHTML = `
        <div style="text-align:center;padding:50px;font-family:Arial;">
          <h1 style="color:red;">Limit Expired üö´</h1>
          <p>Join our Telegram channel for more offers:</p>
          <a href="${TELEGRAM_URL}" target="_blank" style="background:#0088CC;color:white;padding:10px 20px;border-radius:6px;text-decoration:none;">JOIN TELEGRAM</a>
        </div>
      `;
    }

    if (totalNumbersShown >= MAX_NUMBERS) {
      showLimitExpired();
      return;
    }

    clickCount++;
    localStorage.setItem('linkClicks', clickCount);

    if (clickCount >= THRESHOLD) {
      telegramRedirectCount++;
      localStorage.setItem('tgRedirects', telegramRedirectCount);

      alert("‚ö†Ô∏è Please join our Telegram channel first!");
      window.location.href = TELEGRAM_URL;
      localStorage.clear();
      return;
    }

    totalNumbersShown++;
    localStorage.setItem('totalNumbersShown', totalNumbersShown);

    const pick = numbers[Math.floor(Math.random() * numbers.length)];
    let decoded = "";

    try {
      decoded = atob(pick).trim();
    } catch {
      alert("Decode error! Base64 string invalid.");
      return;
    }

    // If number doesn't start with 91, fix it
    if (!decoded.startsWith("91")) {
      decoded = "91" + decoded.replace(/\D/g, "");
    }

    const finalURL = `https://wa.me/${decoded}`;
    console.log("Redirecting to:", finalURL);
    window.location.href = finalURL;

  } catch (err) {
    console.error("Error:", err);
    document.body.innerHTML = '<div style="color:red;text-align:center;padding:50px;">Error: Please refresh.</div>';
  }
});
</script>
